package com.unrealedz.wstation;

import com.unrealedz.wstation.LocationLoader.LocationLoaderCallBack;
import com.unrealedz.wstation.NetworkLoader.LoaderCallBack;
import com.unrealedz.wstation.utils.Contract;
import com.unrealedz.wstation.utils.UtilsNet;

import android.app.Service;
import android.content.Intent;
import android.os.IBinder;
import android.util.Log;

public class UpdateService extends Service implements LoaderCallBack, LocationLoaderCallBack {
	
	String url = "http://xml.weather.co.ua/1.2/forecast/23?dayf=5&lang=uk";
	
	NetworkLoader nLoader;
	NetworkLoader cLoader;
	LocationLoader locationLoader;
	
	@Override  
    public void onCreate()  
    {  
        super.onCreate();  
    }  
  
    @Override  
    public int onStartCommand(Intent intent, int flags, int startId)  
    {  
        buildUpdate();  
  
        return super.onStartCommand(intent, flags, startId);  
    }

	private void buildUpdate() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public IBinder onBind(Intent arg0) {
		// TODO Auto-generated method stub
		return null;
	}
	
    // 1 // Loader of DataBase cities //
	private void cityLoad(){
	       boolean flag = UtilsNet.isOnline(getApplicationContext());
	       flag = false;
	   		cLoader = new NetworkLoader(this);
	   		cLoader.setLoaderCallBack(this);
	   		
	    	if (UtilsNet.isOnline(getApplicationContext())) cLoader.execute(Contract.GET_CITY_DB, Contract.CITY_URL);

	    	//else setLocationInfo();
	}
	
	

	@Override
	public void setLocationInfo() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void setLastUpdate() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void setWeekList() {
		// TODO Auto-generated method stub
		
	}

	// 2 //Listener when the citiesDB is loaded
	@Override
	public void onLoadCityDB() {
		locationLoader = new LocationLoader(getApplicationContext());
		locationLoader.setLoaderCallBack(this);
		locationLoader.getLocation();	
	}
	
	
	// 3 //Listener when a current city code is get
	@Override
	public void setLocation(String nameLocation) {
		int cityId = 23; //Kyiv code from dummy
		Log.i("DEBUG CUR", "COD:" + cityId); 
		url = "http://xml.weather.co.ua/1.2/forecast/" + cityId + "?dayf=5&lang=uk";
		refresh();		
	}
	
	
	// 4 // Loader DataBase forecast //
	private void refresh() {
		nLoader = new NetworkLoader(this);
        nLoader.setLoaderCallBack(this); 
    	if (UtilsNet.isOnline(getApplicationContext())) nLoader.execute(Contract.GET_FORECAST, url);
	}

}
